# GitLab NPM Registry

> åŸæ–‡ï¼š[https://docs.gitlab.com/ee/user/packages/npm_registry/](https://docs.gitlab.com/ee/user/packages/npm_registry/)

*   [Enabling the NPM Registry](#enabling-the-npm-registry)
*   [Getting started](#getting-started)
    *   [Installing NPM](#installing-npm)
    *   [Installing Yarn](#installing-yarn)
    *   [Creating a project](#creating-a-project)
*   [Authenticating to the GitLab NPM Registry](#authenticating-to-the-gitlab-npm-registry)
    *   [Authenticating with a personal access token or deploy token](#authenticating-with-a-personal-access-token-or-deploy-token)
    *   [Using variables to avoid hard-coding auth token values](#using-variables-to-avoid-hard-coding-auth-token-values)
    *   [Authenticating with a CI job token](#authenticating-with-a-ci-job-token)
*   [Uploading packages](#uploading-packages)
*   [Uploading a package with the same version twice](#uploading-a-package-with-the-same-version-twice)
*   [Package naming convention](#package-naming-convention)
*   [Installing a package](#installing-a-package)
    *   [Forwarding requests to npmjs.org](#forwarding-requests-to-npmjsorg)
*   [Removing a package](#removing-a-package)
*   [Publishing a package with CI/CD](#publishing-a-package-with-cicd)
*   [Troubleshooting](#troubleshooting)
    *   [Error running yarn with NPM registry](#error-running-yarn-with-npm-registry)
    *   [`npm publish` targets default NPM registry (`registry.npmjs.org`)](#npm-publish-targets-default-npm-registry-registrynpmjsorg)
    *   [`npm install` returns `Error: Failed to replace env in config: ${NPM_TOKEN}`](#npm-install-returns-error-failed-to-replace-env-in-config-npm_token)
    *   [`npm install` returns `npm ERR! 403 Forbidden`](#npm-install-returns-npm-err-403-forbidden)
*   [NPM dependencies metadata](#npm-dependencies-metadata)
*   [NPM distribution tags](#npm-distribution-tags)

# GitLab NPM Registry[](#gitlab-npm-registry-premium "Permalink")

[Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/5934) in [GitLab Premium](https://about.gitlab.com/pricing/) 11.7.

ä½¿ç”¨ GitLab NPM æ³¨å†Œè¡¨ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ç©ºé—´æ¥å­˜å‚¨ NPM è½¯ä»¶åŒ….

[![GitLab NPM Registry](img/72befe6a3da1a58465dbf55200aefd26.png)](img/npm_package_view_v12_5.png)

**æ³¨æ„ï¼š**ä»…æ”¯æŒ[ä½œç”¨åŸŸçš„](https://s0docs0npmjs0com.icopy.site/misc/scope)ç¨‹åºåŒ….

## Enabling the NPM Registry[](#enabling-the-npm-registry "Permalink")

**æ³¨æ„ï¼š**ä»…å½“æ‚¨çš„ GitLab ç®¡ç†å‘˜[å¯ç”¨äº†å¯¹ NPM æ³¨å†Œè¡¨çš„æ”¯æŒæ—¶ï¼Œ](../../../administration/packages/index.html)æ­¤é€‰é¡¹æ‰å¯ç”¨.

å¯ç”¨ NPM æ³¨å†Œè¡¨åï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒå°†å¯ç”¨äºæ‰€æœ‰æ–°é¡¹ç›®. è¦ä¸ºç°æœ‰é¡¹ç›®å¯ç”¨å®ƒï¼Œæˆ–è€…è¦ç¦ç”¨å®ƒï¼š

1.  å¯¼èˆªåˆ°é¡¹ç›®çš„**"è®¾ç½®">"å¸¸è§„">"å¯è§æ€§ï¼Œé¡¹ç›®åŠŸèƒ½ï¼Œæƒé™"** .
2.  æ‰¾åˆ°"è½¯ä»¶åŒ…"åŠŸèƒ½å¹¶å¯ç”¨æˆ–ç¦ç”¨å®ƒ.
3.  å•å‡»**ä¿å­˜æ›´æ”¹**ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆ.

ç„¶åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨å·¦ä¾§æ ä¸­çœ‹åˆ°" **ç¨‹åºåŒ…å’Œæ³¨å†Œè¡¨"**éƒ¨åˆ†.

åœ¨ç»§ç»­ä½¿ç”¨ GitLab NPM æ³¨å†Œè¡¨è¿›è¡Œèº«ä»½éªŒè¯ä¹‹å‰ï¼Œæ‚¨åº”è¯¥ç†Ÿæ‚‰è½¯ä»¶åŒ…çš„å‘½åçº¦å®š.

## Getting started[](#getting-started "Permalink")

æœ¬èŠ‚å°†ä»‹ç»å®‰è£… NPMï¼ˆæˆ– Yarnï¼‰å¹¶ä¸ºæ‚¨çš„ JavaScript é¡¹ç›®æ„å»ºè½¯ä»¶åŒ…. å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ NPM è½¯ä»¶åŒ…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿå…¥é—¨. å¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨ NPM å¹¶äº†è§£å¦‚ä½•æ„å»ºè‡ªå·±çš„è½¯ä»¶åŒ…ï¼Œè¯·ç»§ç»­[ä¸‹ä¸€èŠ‚](#authenticating-to-the-gitlab-npm-registry) .

### Installing NPM[](#installing-npm "Permalink")

æŒ‰ç…§[npmjs.com](https://s0docs0npmjs0com.icopy.site/downloading-and-installing-node-js-and-npm)ä¸Šçš„è¯´æ˜ä¸‹è½½ Node.js å’Œ NPM å¹¶å°†å…¶å®‰è£…åˆ°æœ¬åœ°å¼€å‘ç¯å¢ƒ.

å®‰è£…å®Œæˆåï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ NPMï¼š

```
npm --version 
```

æ‚¨åº”è¯¥ä¼šåœ¨è¾“å‡ºä¸­çœ‹åˆ° NPM ç‰ˆæœ¬ï¼š

```
6.10.3 
```

### Installing Yarn[](#installing-yarn "Permalink")

æ‚¨å¯èƒ½éœ€è¦å®‰è£…å¹¶ä½¿ç”¨ Yarn æ›¿ä»£ NPM. è¯·æŒ‰ç…§[yarnpkg.com](https://classic.yarnpkg.com/en/docs/install)ä¸Šçš„è¯´æ˜åœ¨æ‚¨çš„å¼€å‘ç¯å¢ƒä¸Šè¿›è¡Œå®‰è£….

Once installed, you can verify that Yarn is available with the following command:

```
yarn --version 
```

You should see the version printed like so:

```
1.19.1 
```

### Creating a project[](#creating-a-project "Permalink")

äº†è§£å¦‚ä½•åˆ›å»ºå®Œæ•´çš„ JavaScript é¡¹ç›®ä¸åœ¨æœ¬æŒ‡å—çš„èŒƒå›´å†…ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºå¹¶å¯¼èˆªåˆ°ç©ºç›®å½•å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ–æ–°çš„ç©ºåŒ…ï¼š

```
npm init 
```

æˆ–è€…ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Yarnï¼š

```
yarn init 
```

è¿™å°†å¸¦æ‚¨è§£å†³ä¸€ç³»åˆ—é—®é¢˜ï¼Œä»¥äº§ç”Ÿ`package.json`æ–‡ä»¶ï¼Œè¿™æ˜¯æ‰€æœ‰ NPM è½¯ä»¶åŒ…æ‰€å¿…éœ€çš„. æœ€é‡è¦çš„é—®é¢˜æ˜¯è½¯ä»¶åŒ…åç§°. NPM è½¯ä»¶åŒ…å¿…é¡»[éµå¾ªå‘½åçº¦å®šï¼Œ](#package-naming-convention)å¹¶ä¸”èŒƒå›´åº”é™äºæ³¨å†Œè¡¨æ‰€åœ¨çš„é¡¹ç›®æˆ–ç»„.

å®Œæˆè®¾ç½®åï¼Œç°åœ¨å°±å¯ä»¥å°†è½¯ä»¶åŒ…ä¸Šä¼ åˆ° GitLab æ³¨å†Œè¡¨äº†. é¦–å…ˆï¼Œæ‚¨éœ€è¦è®¾ç½®èº«ä»½éªŒè¯ï¼Œç„¶åå°† GitLab é…ç½®ä¸ºè¿œç¨‹æ³¨å†Œè¡¨.

## Authenticating to the GitLab NPM Registry[](#authenticating-to-the-gitlab-npm-registry "Permalink")

å¦‚æœé¡¹ç›®æ˜¯ç§æœ‰é¡¹ç›®ï¼Œæˆ–è€…æ‚¨è¦å°† NPM è½¯ä»¶åŒ…ä¸Šä¼ åˆ° GitLabï¼Œåˆ™éœ€è¦æä¾›å‡­æ®è¿›è¡Œèº«ä»½éªŒè¯. é¦–é€‰[ä¸ªäººè®¿é—®ä»¤ç‰Œ](../../profile/personal_access_tokens.html)å’Œ[éƒ¨ç½²ä»¤ç‰Œ](../../project/deploy_tokens/index.html) ï¼Œä½†æ”¯æŒ[OAuth ä»¤ç‰Œ](../../../api/oauth2.html#resource-owner-password-credentials-flow) .

**åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰ä»…æ”¯æŒä¸ªäººè®¿é—®ä»¤ç‰Œï¼š**å¦‚æœä½ æœ‰ 2FA å¯ç”¨ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ª[ä»¤ç‰Œä¸ªäººè®¿é—®](../../profile/personal_access_tokens.html)ä½¿ç”¨ OAuth æ ‡é¢˜ä¸èŒƒå›´è®¾ç½®ä¸º`api`æˆ–[ä»¤ç‰Œéƒ¨ç½²](../../project/deploy_tokens/index.html)ä¸`read_package_registry`æˆ–`write_package_registry`èŒƒå›´. æ ‡å‡† OAuth ä»¤ç‰Œå°†æ— æ³•å‘ GitLab NPM æ³¨å†Œè¡¨è¿›è¡Œèº«ä»½éªŒè¯.

### Authenticating with a personal access token or deploy token[](#authenticating-with-a-personal-access-token-or-deploy-token "Permalink")

è¦ä½¿ç”¨[ä¸ªäººè®¿é—®ä»¤ç‰Œ](../../profile/personal_access_tokens.html)æˆ–[éƒ¨ç½²ä»¤ç‰Œè¿›è¡Œ](../../project/deploy_tokens/index.html)èº«ä»½éªŒè¯ï¼Œè¯·è®¾ç½® NPM é…ç½®ï¼š

```
# Set URL for your scoped packages.
# For example package with name `@foo/bar` will use this URL for download
npm config set @foo:registry https://gitlab.com/api/v4/packages/npm/

# Add the token for the scoped packages URL. This will allow you to download
# `@foo/` packages from private projects.
npm config set '//gitlab.com/api/v4/packages/npm/:_authToken' "<your_token>"

# Add token for uploading to the registry. Replace <your_project_id>
# with the project you want your package to be uploaded to.
npm config set '//gitlab.com/api/v4/projects/<your_project_id>/packages/npm/:_authToken' "<your_token>" 
```

å°†`<your_project_id>`æ›¿æ¢ä¸ºå¯ä»¥åœ¨é¡¹ç›®ä¸»é¡µä¸Šæ‰¾åˆ°çš„é¡¹ç›® IDï¼Œå¹¶å°†`<your_token>`æ›¿æ¢ä¸ºä¸ªäººè®¿é—®ä»¤ç‰Œæˆ–éƒ¨ç½²ä»¤ç‰Œ.

å¦‚æœæ‚¨å…·æœ‰è‡ªè¡Œç®¡ç†çš„ GitLab å®‰è£…ï¼Œ `gitlab.com`ä½¿ç”¨æ‚¨çš„åŸŸåæ›¿æ¢`gitlab.com` .

ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå°† NPM è½¯ä»¶åŒ…ä¸‹è½½å¹¶ä¸Šä¼ åˆ°æ‚¨çš„é¡¹ç›®.

**æ³¨æ„ï¼š**å¦‚æœé‡åˆ°æœ‰å…³[Yarn](https://classic.yarnpkg.com/en/)çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯·å‚é˜…[æ•…éšœæ’é™¤éƒ¨åˆ†](#troubleshooting) .

### Using variables to avoid hard-coding auth token values[](#using-variables-to-avoid-hard-coding-auth-token-values "Permalink")

ä¸ºäº†é¿å…å¯¹`authToken`å€¼è¿›è¡Œç¡¬ç¼–ç ï¼Œå¯ä»¥åœ¨å…¶ä½ç½®ä½¿ç”¨å˜é‡ï¼š

```
npm config set '//gitlab.com/api/v4/projects/<your_project_id>/packages/npm/:_authToken' "${NPM_TOKEN}"
npm config set '//gitlab.com/api/v4/packages/npm/:_authToken' "${NPM_TOKEN}" 
```

ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨æœ¬åœ°æˆ–é€šè¿‡ GitLab CI / CD è¿è¡Œ`npm publish` ï¼š

*   **æœ¬åœ°ï¼š**å‘å¸ƒå‰å¯¼å‡º`NPM_TOKEN` ï¼š

    ```
    NPM_TOKEN=<your_token> npm publish 
    ```

*   **GitLab CI / CDï¼š**è®¾ç½®`NPM_TOKEN` [å˜é‡](../../../ci/variables/README.html)ä¸‹ï¼Œé¡¹ç›®çš„**è®¾ç½®> CI / CD>å˜é‡** .

### Authenticating with a CI job token[](#authenticating-with-a-ci-job-token "Permalink")

åœ¨ GitLab Premium 12.5 ä¸­[å¼•å…¥](https://gitlab.com/gitlab-org/gitlab/-/issues/9104) .

å¦‚æœæ‚¨å°† NPM ä¸ GitLab CI / CD ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ CI ä½œä¸šä»¤ç‰Œä»£æ›¿ä¸ªäººè®¿é—®ä»¤ç‰Œæˆ–éƒ¨ç½²ä»¤ç‰Œ. ä»¤ç‰Œå°†ç»§æ‰¿ç”Ÿæˆç®¡é“çš„ç”¨æˆ·çš„æƒé™.

å°†ç›¸åº”çš„éƒ¨åˆ†æ·»åŠ åˆ°æ‚¨çš„`.npmrc`æ–‡ä»¶ä¸­ï¼š

```
@foo:registry=https://gitlab.com/api/v4/packages/npm/
//gitlab.com/api/v4/packages/npm/:_authToken=${CI_JOB_TOKEN}
//gitlab.com/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN} 
```

## Uploading packages[](#uploading-packages "Permalink")

åœ¨èƒ½å¤Ÿä¸Šè½½è½¯ä»¶åŒ…ä¹‹å‰ï¼Œæ‚¨éœ€è¦ä¸º NPM æŒ‡å®šæ³¨å†Œè¡¨. ä¸ºæ­¤ï¼Œå°†ä»¥ä¸‹éƒ¨åˆ†æ·»åŠ åˆ°`package.json`çš„åº•éƒ¨ï¼š

```
"publishConfig":  {  "@foo:registry":"https://gitlab.com/api/v4/projects/<your_project_id>/packages/npm/"  } 
```

å°†`<your_project_id>`æ›¿æ¢ä¸ºæ‚¨çš„é¡¹ç›® IDï¼ˆå¯åœ¨é¡¹ç›®çš„ä¸»é¡µä¸Šæ‰¾åˆ°ï¼‰ï¼Œç„¶åå°†`@foo`æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ä½œç”¨åŸŸ.

å¦‚æœæ‚¨å…·æœ‰è‡ªè¡Œç®¡ç†çš„ GitLab å®‰è£…ï¼Œ `gitlab.com`ä½¿ç”¨æ‚¨çš„åŸŸåæ›¿æ¢`gitlab.com` .

å¯ç”¨å®ƒå¹¶è®¾ç½®[èº«ä»½éªŒè¯å](#authenticating-to-the-gitlab-npm-registry) ï¼Œæ‚¨å¯ä»¥å°† NPM åŒ…ä¸Šä¼ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼š

```
npm publish 
```

ç„¶åï¼Œæ‚¨å¯ä»¥å¯¼èˆªåˆ°é¡¹ç›®çš„" **ç¨‹åºåŒ…å’Œæ³¨å†Œè¡¨"**é¡µé¢ï¼ŒæŸ¥çœ‹ä¸Šè½½çš„ç¨‹åºåŒ…ï¼Œç”šè‡³åˆ é™¤å®ƒä»¬.

å¦‚æœå°è¯•ä½¿ç”¨ç»™å®šèŒƒå›´å†…å·²ç»å­˜åœ¨çš„åç§°å‘å¸ƒç¨‹åºåŒ…ï¼Œåˆ™ä¼šæ”¶åˆ°`403 Forbidden!` é”™è¯¯.

## Uploading a package with the same version twice[](#uploading-a-package-with-the-same-version-twice "Permalink")

æ‚¨ä¸èƒ½ä¸¤æ¬¡ä¸Šä¼ ç›¸åŒåç§°å’Œç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Œé™¤éå…ˆåˆ é™¤ç°æœ‰è½¯ä»¶åŒ…. è¿™ä¸ npmjs.org çš„è¡Œä¸ºä¿æŒä¸€è‡´ï¼Œä½† npmjs.org ä¸å…è®¸ç”¨æˆ·å¤šæ¬¡å‘å¸ƒåŒä¸€ç‰ˆæœ¬ï¼Œå³ä½¿è¯¥ç‰ˆæœ¬å·²è¢«åˆ é™¤ä¹Ÿæ˜¯å¦‚æ­¤.

## Package naming convention[](#package-naming-convention "Permalink")

**ç¨‹åºåŒ…çš„ä½œç”¨åŸŸå¿…é¡»åœ¨é¡¹ç›®çš„æ ¹åç§°ç©ºé—´ä¸­** . ç¨‹åºåŒ…åç§°å¯ä»¥æ˜¯ä»»ä½•åç§°ï¼Œä½†æœ€å¥½ä½¿ç”¨é¡¹ç›®åç§°ï¼Œé™¤éç”±äºå‘½åå†²çªè€Œæ— æ³•ä½¿ç”¨. ä¾‹å¦‚ï¼š

| Project | Package | Supported |
| --- | --- | --- |
| `foo/bar` | `@foo/bar` | Yes |
| `foo/bar/baz` | `@foo/baz` | Yes |
| `foo/bar/buz` | `@foo/anything` | Yes |
| `gitlab-org/gitlab` | `@gitlab-org/gitlab` | Yes |
| `gitlab-org/gitlab` | `@foo/bar` | No |

ç”¨äºå‘½åçš„æ­£åˆ™è¡¨è¾¾å¼æ­£åœ¨éªŒè¯æ¥è‡ªæ‰€æœ‰ç¨‹åºåŒ…ç®¡ç†å™¨çš„æ‰€æœ‰ç¨‹åºåŒ…åç§°ï¼š

```
/\A\@?(([\w\-\.\+]*)\/)*([\w\-\.]+)@?(([\w\-\.\+]*)\/)*([\w\-\.]*)\z/ 
```

å®ƒå…è®¸ä½¿ç”¨å¤§å†™å­—æ¯ï¼Œè€Œ NPM ä¸å…è®¸ï¼Œå¹¶ä¸”å‡ ä¹å…è®¸ NPM å…è®¸çš„æ‰€æœ‰å­—ç¬¦ï¼Œä½†æœ‰å°‘æ•°ä¾‹å¤–ï¼ˆä¸å…è®¸`~` ï¼‰.

**æ³¨æ„ï¼š**éœ€è¦å¤§å†™å­—æ¯ï¼Œå› ä¸ºè¦æ±‚èŒƒå›´å¿…é¡»ä¸é¡¹ç›®çš„é¡¶çº§åç§°ç©ºé—´ç›¸åŒ. å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„é¡¹ç›®è·¯å¾„ä¸º`My-Group/project-foo` ï¼Œåˆ™æ‚¨çš„ç¨‹åºåŒ…å¿…é¡»å‘½åä¸º`@My-Group/any-package-name` . `@my-group/any-package-name`ä¸èµ·ä½œç”¨.**åœ¨æ›´æ–°ç”¨æˆ·/ç»„çš„è·¯å¾„æˆ–ä¼ è¾“ï¼ˆå­ï¼‰ç»„/é¡¹ç›®æ—¶ï¼š**å¦‚æœä½¿ç”¨ NPM åŒ…æ›´æ–°**é¡¹ç›®**çš„æ ¹åç§°ç©ºé—´ï¼Œåˆ™æ›´æ”¹å°†è¢«æ‹’ç». ä¸ºæ­¤ï¼Œè¯·ç¡®ä¿å…ˆåˆ é™¤æ‰€æœ‰ NPM è½¯ä»¶åŒ…. ä¸è¦å¿˜è®°æ›´æ–°`.npmrc`æ–‡ä»¶ä»¥éµå¾ªä¸Šè¿°å‘½åçº¦å®šï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿è¡Œ`npm publish` .

ç°åœ¨ï¼Œæ‚¨å¯ä»¥é…ç½®é¡¹ç›®ä»¥é€šè¿‡ GitLab NPM æ³¨å†Œè¡¨è¿›è¡Œèº«ä»½éªŒè¯.

## Installing a package[](#installing-a-package "Permalink")

NPM è½¯ä»¶åŒ…é€šå¸¸ä½¿ç”¨ JavaScript é¡¹ç›®ä¸­çš„`npm`æˆ–`yarn`å‘½ä»¤å®‰è£…. å¦‚æœå°šæœªå®‰è£…ï¼Œåˆ™éœ€è¦è®¾ç½®ä½œç”¨åŸŸè½¯ä»¶åŒ…çš„ URL. æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œï¼š

```
npm config set @foo:registry https://gitlab.com/api/v4/packages/npm/ 
```

æ‚¨å°†éœ€è¦ç”¨æ‚¨çš„ä½œç”¨åŸŸæ›¿æ¢`@foo` .

æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦ç¡®ä¿å·²è®¾ç½®[èº«ä»½éªŒè¯](#authenticating-to-the-gitlab-npm-registry) ï¼Œä»¥ä¾¿æˆåŠŸå®‰è£…è½¯ä»¶åŒ…. å®Œæˆæ­¤æ“ä½œåï¼Œæ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…è½¯ä»¶åŒ…ï¼š

```
npm install @my-project-scope/my-package 
```

æˆ–è€…ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Yarnï¼š

```
yarn add @my-project-scope/my-package 
```

### Forwarding requests to npmjs.org[](#forwarding-requests-to-npmjsorg "Permalink")

[Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/55344) in [GitLab Premium](https://about.gitlab.com/pricing/) 12.9.

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“åœ¨ GitLab NPM æ³¨å†Œè¡¨ä¸­æ‰¾ä¸åˆ° NPM è½¯ä»¶åŒ…æ—¶ï¼Œè¯¥è¯·æ±‚å°†è½¬å‘åˆ°[npmjs.com](https://s0www0npmjs0com.icopy.site/) .

ç®¡ç†å‘˜å¯ä»¥åœ¨" [æŒç»­é›†æˆ"è®¾ç½®ä¸­](../../admin_area/settings/continuous_integration.html)ç¦ç”¨æ­¤è¡Œä¸º.

## Removing a package[](#removing-a-package "Permalink")

åœ¨é¡¹ç›®é¡µé¢çš„è½¯ä»¶åŒ…è§†å›¾ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡å•å‡»çº¢è‰²åƒåœ¾å›¾æ ‡æˆ–å•å‡»è½¯ä»¶åŒ…è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸Šçš„**åˆ é™¤**æŒ‰é’®æ¥**åˆ é™¤**è½¯ä»¶åŒ….

## Publishing a package with CI/CD[](#publishing-a-package-with-cicd "Permalink")

è¦åœ¨[GitLab CI / CD ä¸­](./../../../ci/README.html)ä½¿ç”¨ NPM å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨`CI_JOB_TOKEN`ä»£æ›¿ä¸ªäººè®¿é—®ä»¤ç‰Œæˆ–åœ¨å‘½ä»¤ä¸­éƒ¨ç½²ä»¤ç‰Œ.

ä¸€ä¸ªç®€å•çš„`.gitlab-ci.yml`æ–‡ä»¶ç¤ºä¾‹ï¼Œç”¨äºå‘å¸ƒ NPM è½¯ä»¶åŒ…ï¼š

```
image: node:latest

stages:
  - deploy

deploy:
  stage: deploy
  script:
    - echo '//gitlab.com/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN}'>.npmrc
    - npm publish 
```

äº†è§£æœ‰å…³[ä½¿ç”¨`CI_JOB_TOKEN`éªŒè¯ GitLab NPM æ³¨å†Œè¡¨çš„æ›´å¤šä¿¡æ¯](#authenticating-with-a-ci-job-token) .

## Troubleshooting[](#troubleshooting "Permalink")

### Error running yarn with NPM registry[](#error-running-yarn-with-npm-registry "Permalink")

å¦‚æœæ‚¨åœ¨ NPM æ³¨å†Œè¡¨ä¸­ä½¿ç”¨[yarn](https://classic.yarnpkg.com/en/) ï¼Œåˆ™å¯èƒ½ä¼šæ”¶åˆ°ä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š

```
yarn install v1.15.2
warning package.json: No license field
info No lockfile found.
warning XXX: No license field
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
error An unexpected error occurred: "https://gitlab.com/api/v4/projects/XXX/packages/npm/XXX/XXX/-/XXX/XXX-X.X.X.tgz: Request failed \"404 Not Found\"".
info If you think this is a bug, please open a bug report with the information provided in "/Users/XXX/gitlab-migration/module-util/yarn-error.log".
info Visit https://classic.yarnpkg.com/en/docs/cli/install for documentation about this command 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·å°è¯•å°†å…¶æ·»åŠ åˆ°æ‚¨çš„`.npmrc`æ–‡ä»¶ä¸­ï¼ˆå¹¶å°†`<your_token>`æ›¿æ¢ä¸ºæ‚¨çš„ä¸ªäººè®¿é—®ä»¤ç‰Œæˆ–éƒ¨ç½²ä»¤ç‰Œï¼‰ï¼š

```
//gitlab.com/api/v4/projects/:_authToken=<your_token> 
```

### `npm publish` targets default NPM registry (`registry.npmjs.org`)[](#npm-publish-targets-default-npm-registry-registrynpmjsorg "Permalink")

ç¡®ä¿åœ¨`package.json`å’Œ`.npmrc`æ–‡ä»¶ä¸­ä¸€è‡´è®¾ç½®äº†åŒ…ä½œç”¨åŸŸ.

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ GitLab ä¸­çš„é¡¹ç›®åç§°ä¸º`foo/my-package` ï¼Œåˆ™`package.json`æ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

```
{  "name":  "@foo/my-package",  "version":  "1.0.0",  "description":  "Example package for GitLab NPM registry",  "publishConfig":  {  "@foo:registry":"https://gitlab.com/api/v4/projects/<your_project_id>/packages/npm/"  }  } 
```

`.npmrc`æ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

```
//gitlab.com/api/v4/projects/<your_project_id>/packages/npm/:_authToken=<your_token>
//gitlab.com/api/v4/packages/npm/:_authToken=<your_token>
@foo:registry=https://gitlab.com/api/v4/packages/npm/ 
```

### `npm install` returns `Error: Failed to replace env in config: ${NPM_TOKEN}`[](#npm-install-returns-error-failed-to-replace-env-in-config-npm_token "Permalink")

é™¤éæ‚¨çš„é¡¹ç›®æ˜¯ç§æœ‰çš„ï¼Œå¦åˆ™æ‚¨ä¸éœ€è¦ä»¤ç‰Œå³å¯è¿è¡Œ`npm install` ï¼ˆä»…è¦æ±‚å‘å¸ƒä»¤ç‰Œï¼‰. å¦‚æœ`.npmrc`æ–‡ä»¶æ˜¯ä»¥`$NPM_TOKEN`çš„å¼•ç”¨ç­¾`$NPM_TOKEN` ï¼Œåˆ™å¯ä»¥å°†å…¶åˆ é™¤. å¦‚æœæ‚¨å¸Œæœ›ä¿ç•™å‚è€ƒï¼Œåˆ™éœ€è¦åœ¨è¿è¡Œ`npm install`ä¹‹å‰è®¾ç½®ä¸€ä¸ªå€¼ï¼Œæˆ–è€…ä½¿ç”¨[GitLab ç¯å¢ƒå˜é‡](./../../../ci/variables/README.html)æ¥è®¾ç½®è¯¥å€¼ï¼š

```
NPM_TOKEN=<your_token> npm install 
```

### `npm install` returns `npm ERR! 403 Forbidden`[](#npm-install-returns-npm-err-403-forbidden "Permalink")

*   æ£€æŸ¥æ‚¨çš„ä»¤ç‰Œæ˜¯å¦å·²è¿‡æœŸå¹¶å…·æœ‰é€‚å½“çš„æƒé™.
*   æ£€æŸ¥æ‚¨æ˜¯å¦å°è¯•å‘å¸ƒåç§°åœ¨ç»™å®šèŒƒå›´å†…å·²ç»å­˜åœ¨çš„è½¯ä»¶åŒ….
*   ç¡®ä¿ä½œç”¨åŸŸçš„è½¯ä»¶åŒ… URL åŒ…å«æ–œæ ï¼š
    *   æ­£ç¡®ï¼š `//gitlab.com/api/v4/packages/npm/`
    *   é”™è¯¯çš„ï¼š `//gitlab.com/api/v4/packages/npm`

## NPM dependencies metadata[](#npm-dependencies-metadata "Permalink")

åœ¨ GitLab Premium 12.6 ä¸­[å¼•å…¥](https://gitlab.com/gitlab-org/gitlab/-/issues/11867) .

ä» GitLab 12.6 å¼€å§‹ï¼Œå‘å¸ƒåˆ° GitLab NPM æ³¨å†Œè¡¨çš„æ–°è½¯ä»¶åŒ…å‘ NPM å®¢æˆ·ç«¯å…¬å¼€äº†ä»¥ä¸‹å±æ€§ï¼š

*   name
*   version
*   dist-tags
*   dependencies
    *   dependencies
    *   devDependencies
    *   bundleDependencies
    *   peerDependencies
    *   deprecated

## NPM distribution tags[](#npm-distribution-tags "Permalink")

åœ¨ GitLab Premium 12.8 ä¸­[å¼•å…¥](https://gitlab.com/gitlab-org/gitlab/-/issues/9425) .

æ‚¨å¯ä»¥ä¸ºæ–°å‘å¸ƒçš„è½¯ä»¶åŒ…æ·»åŠ [åˆ†å‘æ ‡ç­¾](https://s0docs0npmjs0com.icopy.site/cli/dist-tag) . å®ƒä»¬éµå¾ª NPM çš„çº¦å®šï¼Œåœ¨è¿™äº›çº¦å®šä¸­å®ƒä»¬æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”æ¯ä¸ªæ ‡ç­¾ä¸€æ¬¡åªèƒ½åˆ†é…ç»™ä¸€ä¸ªè½¯ä»¶åŒ…. å½“å‘å¸ƒæ²¡æœ‰æ ‡ç­¾çš„è½¯ä»¶åŒ…æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ·»åŠ `latest`æ ‡ç­¾. åœ¨æœªæŒ‡å®šæ ‡ç­¾æˆ–ç‰ˆæœ¬çš„æƒ…å†µä¸‹å®‰è£…è½¯ä»¶åŒ…ä¹Ÿæ˜¯å¦‚æ­¤.

æ”¯æŒçš„`dist-tag`å‘½ä»¤å’Œé€šå¸¸ä½¿ç”¨æ ‡ç­¾çš„ç¤ºä¾‹ï¼š

```
npm publish @scope/package --tag               # Publish new package with new tag
npm dist-tag add @scope/package@version my-tag # Add a tag to an existing package
npm dist-tag ls @scope/package                 # List all tags under the package
npm dist-tag rm @scope/package@version my-tag  # Delete a tag from the package
npm install @scope/package@my-tag              # Install a specific tag 
```

**è­¦å‘Šï¼š**ç”±äº NPM 6.9.0 ä¸­çš„é”™è¯¯ï¼Œåˆ é™¤ dist æ ‡ç­¾å¤±è´¥. ç¡®ä¿æ‚¨çš„ NPM ç‰ˆæœ¬å¤§äº 6.9.1.